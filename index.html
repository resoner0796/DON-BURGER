<!DOCTYPE html>
<html lang="es">
<head>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDo5_fW7dxBnfkOnZOmpaRcbsCDetk-faw" async defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Don Burger | App</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>

    <header class="main-header">
        <button class="icon-btn" onclick="toggleMenu()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <div class="logo-container">
            <img src="logotienda.png" alt="Don Burger" class="app-logo">
        </div>

        <div style="display: flex; gap: 10px; align-items: center;">
            <button class="icon-btn" id="theme-toggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>

            <div class="cart-wrapper" onclick="toggleCart()">
                <button class="icon-btn">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </button>
                <span id="cart-badge" class="badge hidden">0</span>
            </div>
        </div>
    </header>

    <div id="menu-overlay" class="overlay-menu" onclick="toggleMenu()"></div>
    
    <aside id="side-drawer" class="drawer-left">
        <button class="close-sidebar-btn" onclick="toggleMenu()">âœ•</button>

        <div class="user-section-pro">
            <div id="user-info" class="hidden user-card-content">
                <div class="avatar-container">
                    <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User" class="avatar-pro">
                    <div class="online-indicator"></div>
                </div>
                <div class="user-details">
                    <p id="user-name-display" class="user-name-pro">Usuario</p>
                    <small onclick="askLogout()" class="logout-pill">Cerrar SesiÃ³n</small>
                </div>
            </div>
            
            <div id="auth-buttons" class="auth-card-content">
                <h3>Â¡Hola! ğŸ”</h3>
                <p>Inicia sesiÃ³n para pedir tus burgers</p>
                <button class="btn-primary-outline" onclick="openAuth()">Acceder</button>
            </div>
        </div>

        <div class="menu-nav">
            <div id="client-menu" class="hidden">
                <h4>Mi Cuenta</h4>
                <ul>
                    <li onclick="openClientOrders()">ğŸ“¦ Mis Pedidos (Tracking)</li>
                </ul>
            </div>

            <h4>MenÃº</h4>
            <ul id="category-list">
                <li onclick="filterProducts('all')" class="active-cat">Todo</li>
            </ul>
        </div>

        <div id="admin-btn-container" class="admin-zone hidden">
            <h4>AdministraciÃ³n Pro</h4>
            <div class="admin-grid-btns">
                <button onclick="openAdmin()" class="btn-sec admin-btn">ğŸ“¦ +Producto</button>
                <button onclick="openInventory()" class="btn-sec admin-btn">ğŸ“‹ Stock</button>
                <button onclick="openOrdersPanel()" class="btn-sec admin-btn">ğŸš€ Pedidos</button>
                <button onclick="openSalesDashboard()" class="btn-sec admin-btn">ğŸ“ˆ Ventas</button>
                <button onclick="openDriversManager()" class="btn-sec admin-btn">ğŸ‘¥ Repartidores</button>
                <button onclick="openBannerAdmin()" class="btn-sec admin-btn">ğŸ–¼ï¸ Banners</button>
            </div>
        </div>
    </aside>

    <main id="app">
        
        <div class="search-container">
             <input type="text" id="search" placeholder="ğŸ” Buscar burgers, papas...">
        </div>

        <div id="promo-carousel" class="hero-carousel-container">
            </div>

        <div id="product-list" class="grid-container">
            <div class="loader" style="text-align:center; padding:20px;">Preparando parrilla...</div>
        </div>
    </main>

    <div id="orders-view" class="full-screen-panel hidden">
        <div class="panel-header">
            <h2>ğŸš€ Pedidos Activos</h2>
            <button onclick="closeOrdersPanel()" class="btn-close-panel">Cerrar</button>
        </div>
        <div id="orders-list" class="orders-container"></div>
    </div>

    <div id="sales-dashboard-view" class="full-screen-panel hidden">
        <div class="panel-header">
            <h2>ğŸ“ˆ Cierre de Ventas</h2>
            <button onclick="document.getElementById('sales-dashboard-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button>
        </div>
        <div class="dashboard-body">
            <div class="kpi-grid">
                <div class="kpi-card"><small>Ventas Cerradas</small><h3 id="kpi-sales-today">$0</h3></div>
                <div class="kpi-card"><small>Entregados</small><h3 id="kpi-orders-today">0</h3></div>
                <div class="kpi-card"><small>Ticket Promedio</small><h3 id="kpi-ticket-avg">$0</h3></div>
            </div>
            <h4 style="margin: 20px 0 10px 0;">âœ… Historial de Pedidos</h4>
            <div id="sales-history-list" class="history-list"></div>
        </div>
    </div>

<div id="drivers-view" class="full-screen-panel hidden">
    <div class="panel-header">
        <h2>ğŸ‘¥ GestiÃ³n de Flotilla</h2>
        <button onclick="document.getElementById('drivers-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button>
    </div>

    <div class="drivers-body" style="padding: 20px; max-width: 800px; margin: 0 auto;">
        
        <div class="driver-form-card" style="background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px; color: var(--primary);">âš¡ Dar de Alta Repartidor</h3>
            <form id="driver-register-form" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <input type="text" id="drv-name" placeholder="Nombre Completo" class="input-field" required>
                <input type="tel" id="drv-phone" placeholder="Celular" class="input-field" required>
                <input type="email" id="drv-email" placeholder="Correo (Usuario)" class="input-field" required>
                <input type="password" id="drv-pass" placeholder="ContraseÃ±a" class="input-field" required>
                <button type="submit" class="btn-primary" style="grid-column: span 2; margin-top: 10px;">Registrar Repartidor</button>
            </form>
        </div>

        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">ğŸï¸ Repartidores Activos</h3>
        <div id="drivers-list" style="display: flex; flex-direction: column; gap: 10px;">
            </div>

    </div>
</div>

    <div id="inventory-view" class="full-screen-panel hidden">
        <div class="panel-header">
            <h2>ğŸ“‹ Control de Stock</h2>
            <button onclick="document.getElementById('inventory-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button>
        </div>
        <div class="inventory-body">
            <input type="text" id="inv-search" placeholder="ğŸ” Buscar..." class="input-field" onkeyup="renderInventory()">
            <div class="inv-header-row" style="grid-template-columns: 2fr 1fr 1fr 0.5fr 0.5fr;">
                <span>Producto</span>
                <span style="text-align:center;">Precio</span>
                <span style="text-align:center;">Stock</span>
                <span style="text-align:center;">Ver</span>
                <span style="text-align:center;">Edit</span>
            </div>
            <div id="inventory-list-container"></div>
        </div>
    </div>

<div id="driver-stats-modal" class="modal-overlay hidden" style="z-index: 2000;">
    <div class="modal-box" style="max-width: 500px; text-align: left;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0;">ğŸ“Š Reporte de Rendimiento</h3>
            <button onclick="closeDriverStats()" class="btn-close" style="padding:5px 10px;">âœ•</button>
        </div>

        <div style="text-align:center; margin-bottom:20px;">
            <h2 id="stats-name" style="color:var(--primary);">Juan PÃ©rez</h2>
            <small style="color:#666;">Resumen Total (Deuda Actual)</small>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
            <div style="background:#f5f5f5; padding:15px; border-radius:10px; text-align:center;">
                <span style="font-size:2rem;">ğŸ“¦</span>
                <div style="font-weight:bold; font-size:1.2rem;" id="stats-orders">0</div>
                <small>Pendientes de Corte</small>
            </div>
            <div style="background:#e8f5e9; padding:15px; border-radius:10px; text-align:center; border:1px solid #c8e6c9;">
                <span style="font-size:2rem;">ğŸ’°</span>
                <div style="font-weight:bold; font-size:1.2rem; color:#2E7D32;" id="stats-earnings">$0</div>
                <small>Su Ganancia (EnvÃ­os)</small>
            </div>
        </div>

        <div style="background: #FFF3E0; padding: 15px; border-radius: 10px; border: 1px dashed #FFB74D;">
            <h4 style="margin-top:0; color:#EF6C00;">ğŸ’µ Corte de Caja (Efectivo)</h4>
            
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span>Cobrado a Clientes:</span>
                <span id="stats-cash-collected" style="font-weight:bold;">$0.00</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #ccc; padding-bottom:5px;">
                <span>(-) Su Ganancia de EnvÃ­os:</span>
                <span id="stats-deduction" style="color:#D32F2F;">- $0.00</span>
            </div>
            
            <div style="display:flex; justify-content:space-between; font-size:1.2rem; margin-top:5px;">
                <strong>A Entregar al Negocio:</strong>
                <strong id="stats-final-pay" style="color:#EF6C00;">$0.00</strong>
            </div>

            <button id="btn-liquidar-corte" onclick="settleDebt()" class="btn-primary" style="margin-top:15px; width:100%; background:#2E7D32; display:none; font-size:1.1rem; box-shadow: 0 4px 10px rgba(46, 125, 50, 0.4);">
                ğŸ’¸ Recibir Dinero y Liquidar
            </button>
        </div>
        
        <p style="text-align: center; font-size: 0.8rem; color: #999; margin-top: 15px;">
            * Este reporte muestra la deuda acumulada real. Al liquidar, el saldo del repartidor volverÃ¡ a $0.
        </p>

        <button onclick="closeDriverStats()" class="btn-primary" style="margin-top:15px; width:100%; background:#666;">Cerrar Reporte</button>
    </div>
</div>

    <div id="ticket-visual-modal" class="modal-overlay" style="display: none; z-index: 3500;">
        <div class="modal-card ticket-modal-content">
            <div class="ticket-visual-header">
                <img src="logotienda.png" class="ticket-logo" alt="Don Burger">
                <h3>Resumen de Pedido</h3>
                <p id="ticket-folio-display" style="color:var(--primary); font-weight:800;">PEDIDO-XXX</p>
                <small id="ticket-date-display" style="color:var(--text-sec);">Fecha</small>
            </div>
            <div id="ticket-items-container" class="ticket-items-list"></div>
            <div class="ticket-visual-footer">
                <div class="summary-row">EnvÃ­o: <span id="ticket-ship-display">$0</span></div>
                <div class="summary-row"><span>Total Pagado:</span> <span id="ticket-total-display" style="font-weight:800; font-size:1.2rem; color:var(--primary);">$0</span></div>
                <div id="ticket-payment-info" style="margin-top:10px; padding-top:10px; border-top:1px dashed #eee; font-size:0.9rem;"></div>
            </div>
            <button onclick="document.getElementById('ticket-visual-modal').style.display='none'" class="btn-close">Cerrar Ticket</button>
        </div>
    </div>

    <div id="client-orders-view" class="full-screen-panel hidden">
        <div class="panel-header">
            <h2>ğŸ“¦ Mis Pedidos</h2>
            <button onclick="document.getElementById('client-orders-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button>
        </div>
        <div id="client-orders-list" class="orders-container"></div>
    </div>

    <div id="auth-modal" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <h3 id="auth-title">Acceso</h3>
            <form id="auth-form">
                <div id="reg-fields" class="hidden">
                    <input type="text" id="reg-name" placeholder="Nombre Completo" class="input-field">
                    <input type="tel" id="reg-phone" placeholder="Celular (10 dÃ­gitos)" class="input-field">
                </div>
                <input type="email" id="auth-email" placeholder="Correo" required class="input-field">
                <input type="password" id="auth-pass" placeholder="ContraseÃ±a" required class="input-field">
                <button type="submit" class="btn-primary">Entrar</button>
            </form>
            <p class="text-link" onclick="toggleAuthMode()" style="margin-top:10px; cursor:pointer; color:var(--primary);">Â¿No tienes cuenta? RegÃ­strate</p>
            <button onclick="closeAuth()" class="btn-close">Cerrar</button>
        </div>
    </div>

    <div id="delete-reason-modal" class="modal-overlay" style="display: none; z-index: 3005;">
        <div class="modal-card">
            <h3>âš ï¸ Eliminar Pedido</h3>
            <p>Se guardarÃ¡ un registro de esta acciÃ³n.</p>
            <textarea id="delete-reason" class="input-field" rows="3" placeholder="Motivo..."></textarea>
            <button onclick="confirmDeleteOrder()" class="btn-primary" style="background:var(--dark);">Confirmar</button>
            <button onclick="closeDeleteModal()" class="btn-close">Cancelar</button>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay" style="display: none; z-index: 2000;">
        <div class="modal-card">
            <h3 id="admin-title">Producto</h3>
            <form id="admin-form">
                <input type="hidden" id="p-id"> 
                <input type="text" id="p-name" placeholder="Nombre (Ej: Doble con Queso)" required class="input-field">
                
                <textarea id="p-desc" placeholder="DescripciÃ³n (Ej: -Carne Angus
-Doble Queso
-Tocino)" class="input-field" rows="3" style="resize: none;"></textarea>
                
                <input type="number" id="p-price" placeholder="Precio" required class="input-field">
                <input type="number" id="p-stock" placeholder="Stock Inicial" class="input-field">
                <input type="text" id="p-cat" placeholder="CategorÃ­a" required list="cat-suggestions" class="input-field">
                <datalist id="cat-suggestions"></datalist>
                <input type="text" id="p-img" placeholder="Foto (ej: burger.jpg)" class="input-field">
                <button type="submit" id="btn-save-prod" class="btn-primary">Guardar</button>
            </form>
            <button onclick="closeAdmin()" class="btn-close">Cancelar</button>
        </div>
    </div>

    <div id="alert-modal" class="modal-overlay" style="display: none; z-index: 3000;">
        <div class="modal-card" style="text-align: center;">
            <h3 id="alert-title">Mensaje</h3>
            <p id="alert-msg">...</p>
            <button onclick="closeCustomAlert()" class="btn-primary">Entendido</button>
        </div>
    </div>
    
    <div id="tracking-modal" class="modal-overlay hidden" style="display:none; z-index: 5000;">
    <div class="modal-card" style="width: 95%; height: 85vh; padding: 0; display:flex; flex-direction:column; overflow:hidden;">
        <div style="padding: 15px; background: white; border-bottom:1px solid #eee; display: flex; justify-content: space-between; align-items:center;">
            <div>
                <h3 style="margin:0; color:#333;">ğŸ“ Tu pedido en camino</h3>
                <small style="color:#666;">ActualizaciÃ³n en tiempo real</small>
            </div>
            <button onclick="closeTracking()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#333;">âœ•</button>
        </div>
        
        <div id="map" style="width: 100%; flex-grow: 1; background: #eee;"></div>
        
        <div style="padding: 15px; background: white; border-top:1px solid #eee; display:flex; align-items:center; gap:10px;">
            <img src="banners/morenitamoto.png" style="width:40px; height:40px;">
            <div>
                <div style="font-weight:bold; color:#333;">Repartidor Don Burger</div>
                <div style="font-size:0.8rem; color:green;">â— Conectado al GPS</div>
            </div>
        </div>
    </div>
</div>

<div id="banner-modal" class="modal-overlay" style="display: none; z-index: 4000;">
    <div class="modal-card">
        <h3>Gestionar Promociones</h3>
        
        <form id="banner-form" style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee;">
            <input type="text" id="ban-img" placeholder="Nombre imagen (ej: promo.jpg)" class="input-field" required>
            
            <select id="ban-loc" class="input-field" required style="background: var(--bg-input);">
                <option value="top">â¬†ï¸ UbicaciÃ³n: Arriba (Principal)</option>
                <option value="mid">â¬‡ï¸ UbicaciÃ³n: En Medio (Entre productos)</option>
            </select>

            <input type="text" id="ban-cat" placeholder="CategorÃ­a Destino" class="input-field" list="cat-suggestions" required>
            <button type="submit" class="btn-primary">Guardar Banner</button>
        </form>

        <h4>Banners Activos:</h4>
        <div id="admin-banner-list" style="display:flex; flex-direction:column; gap:10px; max-height:200px; overflow-y:auto; margin-bottom:15px;"></div>

        <button onclick="closeBannerAdmin()" class="btn-close">Cerrar</button>
    </div>
</div>
    <div id="confirm-modal" class="modal-overlay" style="display: none; z-index: 3001;">
        <div class="modal-card" style="text-align: center;">
            <h3 id="confirm-title">Confirmar</h3>
            <p id="confirm-msg">Â¿EstÃ¡s seguro?</p>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="closeCustomConfirm(false)" class="btn-close" style="margin:0; border:1px solid #ddd">Cancelar</button>
                <button onclick="closeCustomConfirm(true)" class="btn-primary" style="margin:0;">SÃ­</button>
            </div>
        </div>
    </div>

    <div id="cart-drawer" class="drawer-right">
        <div class="drawer-header">
            <h3>Tu Carrito</h3>
            <button onclick="toggleCart()">âœ•</button>
        </div>
        <div id="cart-view" class="cart-view" style="display:contents;">
            <div id="cart-items" class="cart-body"></div>
            <div class="cart-footer">
                <div class="subtotal-row">Subtotal: <span id="cart-subtotal">$0</span></div>
                <button onclick="goToCheckout()" class="btn-primary">Terminar Compra</button>
            </div>
        </div>
        <div id="checkout-view" class="checkout-view hidden" style="display:contents;">
    <div class="checkout-body">
        <button onclick="backToCart()" class="back-link">â† Volver al carrito</button>
        
        <h4 style="margin-bottom:10px;">ğŸ›µ Tipo de Entrega</h4>
        <div class="delivery-switch-container" style="display:flex; gap:10px; margin-bottom:20px;">
            <button id="btn-mode-delivery" class="btn-mode active" onclick="setDeliveryMode('delivery')">
                ğŸ›µ A Domicilio
            </button>
            <button id="btn-mode-pickup" class="btn-mode" onclick="setDeliveryMode('pickup')">
                ğŸ›ï¸ Pasar a Recoger
            </button>
        </div>

        <div id="address-section">
            <h4>ğŸ“ DirecciÃ³n de Entrega</h4>
            <form id="checkout-form-address">
                <input type="text" id="address-street" placeholder="Calle" class="input-checkout">
                <input type="text" id="address-num" placeholder="NÃºmero Exterior" class="input-checkout">
                <input type="text" id="address-ref" placeholder="Referencia" class="input-checkout">
            </form>
        </div>

        <div id="pickup-msg" class="hidden" style="background:#E0F2F1; padding:15px; border-radius:8px; margin-bottom:20px; text-align:center; border:1px solid #009688;">
            <p style="color:#00796B; font-weight:bold; margin:0;">ğŸ“ Recoger en el Negocio</p>
            <small style="color:#004D40;">Pasa por tus Burgers al local.</small>
        </div>

        <h4>ğŸ’³ MÃ©todo de Pago</h4>
        <form id="checkout-form-payment">
            <div class="payment-options">
                <label class="radio-card"><input type="radio" name="payment" value="Efectivo" checked onchange="handlePaymentChange()"><span>ğŸ’µ Efectivo</span></label>
                <label class="radio-card"><input type="radio" name="payment" value="Terminal" onchange="handlePaymentChange()"><span>ğŸ’³ Terminal</span></label>
                <label class="radio-card"><input type="radio" name="payment" value="Transferencia" onchange="handlePaymentChange()"><span>ğŸ“± Transferencia</span></label>
            </div>
            <div id="payment-details" class="payment-details-box hidden"></div>
        </form>
    </div>

    <div class="cart-footer">
        <div class="summary-row">Subtotal: <span id="checkout-subtotal">$0</span></div>
        
        <div class="summary-row">EnvÃ­o: <span id="checkout-shipping">$20</span></div>
        
        <div class="total-row">Total: <span id="checkout-total">$0</span></div>
        <button onclick="processOrder()" id="btn-confirm-order" class="btn-success">Confirmar Pedido</button>
    </div>
</div>
    </div>
    
    <script type="module" src="script.js"></script>
</body>
</html>
