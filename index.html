<!DOCTYPE html>
<html lang="es">
<head>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDo5_fW7dxBnfkOnZOmpaRcbsCDetk-faw" async defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Don Burger | App</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>

    <header class="main-header">
        <button class="icon-btn" onclick="toggleMenu()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <div class="logo-container">
            <img src="logotienda.png" alt="Don Burger" class="app-logo">
        </div>

        <div style="display: flex; gap: 10px; align-items: center;">
            <button class="icon-btn" id="theme-toggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>

            <div class="cart-wrapper" onclick="toggleCart()">
                <button class="icon-btn">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </button>
                <span id="cart-badge" class="badge hidden">0</span>
            </div>
        </div>
    </header>

    <div id="menu-overlay" class="overlay-menu" onclick="toggleMenu()"></div>
    
    <aside id="side-drawer" class="drawer-left">
        <button class="close-sidebar-btn" onclick="toggleMenu()">âœ•</button>

        <div class="user-section-pro">
            <div id="user-info" class="hidden user-card-content">
                <div class="avatar-container">
                    <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User" class="avatar-pro">
                    <div class="online-indicator"></div>
                </div>
                <div class="user-details">
                    <p id="user-name-display" class="user-name-pro">Usuario</p>
                    <small onclick="askLogout()" class="logout-pill">Cerrar SesiÃ³n</small>
                </div>
            </div>
            
            <div id="auth-buttons" class="auth-card-content">
                <h3>Â¡Hola! ğŸ”</h3>
                <p>Inicia sesiÃ³n para pedir tus burgers</p>
                <button class="btn-primary-outline" onclick="openAuth()">Acceder</button>
            </div>
        </div>

        <div class="menu-nav">
            <div id="client-menu" class="hidden">
                <h4>Mi Cuenta</h4>
                <ul>
                    <li onclick="openClientOrders()">ğŸ“¦ Mis Pedidos (Tracking)</li>
                </ul>
            </div>

            <h4>MenÃº</h4>
            <ul id="category-list">
                <li onclick="filterProducts('all')" class="active-cat">Todo</li>
            </ul>
        </div>

        <div id="admin-btn-container" class="admin-zone hidden">
            <h4>AdministraciÃ³n Pro</h4>
            <div class="admin-grid-btns">
                <button onclick="openKitchenMode()" class="btn-sec admin-btn" style="background:#FF6F00; color:white; grid-column: span 2;">ğŸ‘¨â€ğŸ³ PANTALLA COCINA</button>
                <button onclick="openAdmin()" class="btn-sec admin-btn">ğŸ“¦ +Producto</button>
                <button onclick="openIngredientsManager()" class="btn-sec admin-btn">ğŸ¥• Insumos</button>
                <button onclick="openInventory()" class="btn-sec admin-btn">ğŸ“‹ Stock</button>
                <button onclick="openOrdersPanel()" class="btn-sec admin-btn">ğŸš€ Pedidos</button>
                <button onclick="openSalesDashboard()" class="btn-sec admin-btn">ğŸ“ˆ Ventas</button>
                <button onclick="openDriversManager()" class="btn-sec admin-btn">ğŸ‘¥ Repartidores</button>
                <button onclick="openBannerAdmin()" class="btn-sec admin-btn">ğŸ–¼ï¸ Banners</button>
            </div>
        </div>
    </aside>

    <main id="app">
        <div class="search-container">
             <input type="text" id="search" placeholder="ğŸ” Buscar burgers, papas...">
        </div>

        <div id="promo-carousel" class="hero-carousel-container"></div>

        <div id="product-list" class="grid-container">
            <div class="loader" style="text-align:center; padding:20px;">Preparando parrilla...</div>
        </div>
    </main>

    <div id="kitchen-view" class="full-screen-panel hidden" style="background: #1a1a1a;">
        <div class="panel-header" style="background: #333; border-bottom: 1px solid #444;">
            <h2 style="color:white;">ğŸ‘¨â€ğŸ³ Comandas Cocina</h2>
            <button onclick="document.getElementById('kitchen-view').classList.add('hidden')" class="btn-close-panel" style="color:white; border-color:white;">Salir</button>
        </div>
        <div id="kitchen-orders-container" style="padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; overflow-y: auto;">
            </div>
    </div>

    <div id="ingredients-view" class="full-screen-panel hidden">
        <div class="panel-header">
            <h2>ğŸ¥• GestiÃ³n de Insumos</h2>
            <button onclick="document.getElementById('ingredients-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button>
        </div>
        <div class="dashboard-body">
            <div class="driver-form-card" style="background:var(--bg-input); padding:20px; border-radius:12px; margin-bottom:20px;">
                <h3>Agregar Insumo</h3>
                <form id="add-ingredient-form">
                    <input type="hidden" id="ing-id">
                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:10px; margin-bottom:10px;">
                        <input type="text" id="ing-name" placeholder="Nombre Insumo (Ej: Carne Sirloin)" class="input-field" required style="margin:0;">
                        <select id="ing-unit" class="input-field" style="margin:0;">
                            <option value="kg">Kg</option>
                            <option value="g">Gramos</option>
                            <option value="l">Litro</option>
                            <option value="ml">Mililitros</option>
                            <option value="pieza">Pieza</option>
                        </select>
                    </div>
                    <label style="font-size:0.8rem;">Costo por Unidad seleccionada:</label>
                    <input type="number" id="ing-cost" placeholder="Ej: 120.50" class="input-field" step="0.01" required>
                    <button type="submit" class="btn-primary" id="btn-save-ing">Guardar Insumo</button>
                </form>
            </div>
            <h3>Inventario de Insumos</h3>
            <div id="ingredients-list-container" class="history-list"></div>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay" style="display: none; z-index: 2000;">
        <div class="modal-card" style="max-width: 600px; width: 95%;">
            <h3 id="admin-title">GestiÃ³n de Producto</h3>
            <form id="admin-form">
                <input type="hidden" id="p-id">
                
                <div class="form-group">
                    <label>Nombre del Producto</label>
                    <input type="text" id="p-name" placeholder="Ej: Doble con Queso" required class="input-field">
                </div>
                
                <div class="form-group">
                    <label>Tipo de Producto (Define comportamiento)</label>
                    <select id="p-type" class="input-field" onchange="toggleProductFields()">
                        <option value="burger">ğŸ” Hamburguesa (Usa Receta)</option>
                        <option value="fries">ğŸŸ Papas (Usa TamaÃ±os)</option>
                        <option value="soda">ğŸ¥¤ Refresco (Usa Opciones)</option>
                        <option value="extra">ğŸª Extra/Postre (Simple)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>DescripciÃ³n</label>
                    <textarea id="p-desc" placeholder="Ingredientes, detalles..." class="input-field" rows="2" style="resize: none;"></textarea>
                </div>
                
                <div id="fields-recipe" class="hidden" style="border:1px dashed #ccc; padding:10px; border-radius:8px; margin-bottom:15px;">
                    <h4 style="margin: 0 0 10px;">ğŸ‘¨â€ğŸ³ Constructor de Receta</h4>
                    <p style="font-size:0.8rem; color:#666;">Selecciona insumos para calcular el costo real.</p>
                    
                    <div style="background: rgba(0,0,0,0.05); padding:10px; border-radius:8px; margin-bottom:10px;">
                        <div style="display:flex; gap:5px; margin-bottom:5px;">
                            <select id="recipe-ing-select" class="input-field" style="margin:0; flex-grow:1;"></select>
                            <input type="number" id="recipe-qty" placeholder="Cant." class="input-field" style="margin:0; width:80px;">
                            <button type="button" onclick="addToRecipe()" class="btn-primary" style="width:auto; padding:10px;">+</button>
                        </div>
                        <div id="recipe-list-display" style="font-size:0.9rem; color:var(--text-main); max-height:100px; overflow-y:auto;"></div>
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold;">
                        <span>Costo Calculado: <span id="calc-cost" style="color:var(--primary);">$0.00</span></span>
                    </div>
                </div>

                <div id="fields-sizes" class="hidden" style="border:1px dashed #ccc; padding:10px; border-radius:8px; margin-bottom:15px;">
                    <h4 style="margin: 0 0 10px;">ğŸŸ TamaÃ±os y Precios</h4>
                    <div id="sizes-container"></div>
                    <button type="button" onclick="addSizeInput()" style="background:#eee; border:1px solid #ccc; padding:8px; border-radius:4px; width:100%; margin-top:5px;">+ Agregar TamaÃ±o</button>
                </div>

                <div id="fields-options" class="hidden" style="margin-bottom:15px;">
                    <label>ğŸ¥¤ Opciones / Sabores (Uno por lÃ­nea)</label>
                    <textarea id="p-options" placeholder="Coca Cola&#10;Sprite&#10;Fanta" class="input-field" rows="3"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                    <div id="price-container">
                        <label style="font-size:0.9rem; font-weight:bold;">Precio Venta ($)</label>
                        <input type="number" id="p-price" placeholder="0.00" class="input-field" step="0.5">
                    </div>
                    <div id="cost-container">
                        <label style="font-size:0.9rem; font-weight:bold;">Costo Insumos ($)</label>
                        <input type="number" id="p-cost" placeholder="0.00" class="input-field" style="background:#FFF3E0; border-color:#FFB74D;" step="0.01">
                    </div>
                </div>
                
                <div style="text-align:right; font-size:0.9rem; margin-bottom:15px; background:#e8f5e9; padding:5px; border-radius:4px;">
                    Ganancia Estimada: <span id="calc-profit" style="color:green; font-weight:bold;">$0.00 (0%)</span>
                </div>

                <div class="form-group">
                    <label>Stock Inicial</label>
                    <input type="number" id="p-stock" placeholder="Cantidad disponible" class="input-field">
                </div>
                
                <div class="form-group">
                    <label>CategorÃ­a</label>
                    <input type="text" id="p-cat" placeholder="Ej: Burgers, Bebidas" required list="cat-suggestions" class="input-field">
                    <datalist id="cat-suggestions"></datalist>
                </div>
                
                <div class="form-group">
                    <label>URL Imagen</label>
                    <input type="text" id="p-img" placeholder="https://..." class="input-field">
                </div>
                
                <button type="submit" id="btn-save-prod" class="btn-primary" style="font-size:1.1rem; padding:15px;">Guardar Producto</button>
            </form>
            <button onclick="closeAdmin()" class="btn-close">Cancelar</button>
        </div>
    </div>

    <div id="orders-view" class="full-screen-panel hidden"><div class="panel-header"><h2>ğŸš€ Pedidos Activos</h2><button onclick="closeOrdersPanel()" class="btn-close-panel">Cerrar</button></div><div id="orders-list" class="orders-container"></div></div>
    
    <div id="sales-dashboard-view" class="full-screen-panel hidden">
        <div class="panel-header"><h2>ğŸ“ˆ Ventas y Finanzas</h2><button onclick="document.getElementById('sales-dashboard-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button></div>
        <div class="dashboard-body">
            <div class="kpi-grid">
                <div class="kpi-card"><small>Ventas Brutas</small><h3 id="kpi-sales-today">$0.00</h3></div>
                <div class="kpi-card"><small>Ganancia Neta</small><h3 id="kpi-profit-today" style="color:green;">$0.00</h3></div>
                <div class="kpi-card"><small>Pedidos</small><h3 id="kpi-orders-today">0</h3></div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
                <div class="kpi-card" style="border-color: #FFC107;"><small>ğŸ”¥ MÃ¡s Vendido</small><h4 id="kpi-best-seller">--</h4></div>
                <div class="kpi-card" style="border-color: #D32F2F;"><small>ğŸ§Š Menos Vendido</small><h4 id="kpi-worst-seller">--</h4></div>
            </div>
            <h4>Historial de Pedidos</h4>
            <div id="sales-history-list" class="history-list"></div>
        </div>
    </div>

    <div id="drivers-view" class="full-screen-panel hidden">
        <div class="panel-header"><h2>ğŸ‘¥ Repartidores</h2><button onclick="document.getElementById('drivers-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button></div>
        <div class="drivers-body" style="padding:20px;">
            <div class="driver-form-card" style="background:#fff; padding:15px; border-radius:10px; margin-bottom:20px;">
                <h3 style="color:var(--primary);">Nuevo Repartidor</h3>
                <form id="driver-register-form" style="display:grid; gap:10px;">
                    <input type="text" id="drv-name" placeholder="Nombre" class="input-field" required>
                    <input type="email" id="drv-email" placeholder="Email" class="input-field" required>
                    <input type="password" id="drv-pass" placeholder="Pass" class="input-field" required>
                    <button type="submit" class="btn-primary">Registrar</button>
                </form>
            </div>
            <div id="drivers-list"></div>
        </div>
    </div>

    <div id="inventory-view" class="full-screen-panel hidden">
        <div class="panel-header"><h2>ğŸ“‹ Stock</h2><button onclick="document.getElementById('inventory-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button></div>
        <div class="inventory-body"><input type="text" id="inv-search" placeholder="Buscar..." class="input-field" onkeyup="renderInventory()"><div id="inventory-list-container"></div></div>
    </div>

    <div id="banner-modal" class="modal-overlay" style="display:none; z-index:4000;"><div class="modal-card"><h3>Banners</h3><form id="banner-form"><input type="text" id="ban-img" placeholder="Imagen" class="input-field" required><select id="ban-loc" class="input-field"><option value="top">Arriba</option><option value="mid">Medio</option></select><input type="text" id="ban-cat" placeholder="CategorÃ­a" class="input-field" required><button type="submit" class="btn-primary">Guardar</button></form><div id="admin-banner-list"></div><button onclick="closeBannerAdmin()" class="btn-close">Cerrar</button></div></div>
    
    <div id="client-orders-view" class="full-screen-panel hidden"><div class="panel-header"><h2>Mis Pedidos</h2><button onclick="document.getElementById('client-orders-view').classList.add('hidden')" class="btn-close-panel">Cerrar</button></div><div id="client-orders-list" class="orders-container"></div></div>
    
    <div id="auth-modal" class="modal-overlay" style="display:none;"><div class="modal-card"><h3>Acceso</h3><form id="auth-form"><div id="reg-fields" class="hidden"><input type="text" id="reg-name" placeholder="Nombre" class="input-field"><input type="tel" id="reg-phone" placeholder="Celular" class="input-field"></div><input type="email" id="auth-email" placeholder="Correo" class="input-field"><input type="password" id="auth-pass" placeholder="Pass" class="input-field"><button type="submit" class="btn-primary">Entrar</button></form><p class="text-link" onclick="toggleAuthMode()" style="margin-top:10px; cursor:pointer;">Â¿Crear cuenta?</p><button onclick="closeAuth()" class="btn-close">Cerrar</button></div></div>
    
    <div id="delete-reason-modal" class="modal-overlay" style="display:none;"><div class="modal-card"><h3>Eliminar</h3><textarea id="delete-reason" class="input-field" placeholder="RazÃ³n..."></textarea><button onclick="confirmDeleteOrder()" class="btn-primary">Confirmar</button><button onclick="closeDeleteModal()" class="btn-close">Cancelar</button></div></div>
    
    <div id="ticket-visual-modal" class="modal-overlay" style="display: none; z-index: 3500;"><div class="modal-card ticket-modal-content"><div class="ticket-visual-header"><h3>Ticket</h3><p id="ticket-folio-display"></p></div><div id="ticket-items-container"></div><div class="ticket-visual-footer"><div class="summary-row">Total: <span id="ticket-total-display"></span></div></div><button onclick="document.getElementById('ticket-visual-modal').style.display='none'" class="btn-close">Cerrar</button></div></div>
    
    <div id="driver-stats-modal" class="modal-overlay hidden" style="z-index: 2000;"><div class="modal-box" style="background:#fff; padding:20px; border-radius:10px;"><h3 id="stats-name"></h3><div id="stats-orders"></div><div id="stats-final-pay" style="font-size:1.5rem; font-weight:bold; margin:20px 0;"></div><button id="btn-liquidar-corte" onclick="settleDebt()" class="btn-primary">Liquidar</button><button onclick="closeDriverStats()" class="btn-close">Cerrar</button></div></div>

    <div id="tracking-modal" class="modal-overlay hidden" style="display:none; z-index: 5000;"><div class="modal-card" style="width: 95%; height: 85vh; padding: 0; display:flex; flex-direction:column;"><div style="padding:15px; display:flex; justify-content:space-between;"><h3>ğŸ“ Rastreo</h3><button onclick="closeTracking()">âœ•</button></div><div id="map" style="flex-grow:1;"></div></div></div>
    
    <div id="alert-modal" class="modal-overlay" style="display:none; z-index:3000;"><div class="modal-card" style="text-align:center;"><h3 id="alert-title"></h3><p id="alert-msg"></p><button onclick="closeCustomAlert()" class="btn-primary">OK</button></div></div>
    <div id="confirm-modal" class="modal-overlay" style="display:none; z-index:3001;"><div class="modal-card" style="text-align:center;"><h3 id="confirm-title"></h3><p id="confirm-msg"></p><div style="display:flex; gap:10px;"><button onclick="closeCustomConfirm(false)" class="btn-close">No</button><button onclick="closeCustomConfirm(true)" class="btn-primary">SÃ­</button></div></div></div>

    <div id="cart-drawer" class="drawer-right">
        <div class="drawer-header"><h3>Tu Carrito</h3><button onclick="toggleCart()">âœ•</button></div>
        <div id="cart-view" class="cart-view" style="display:contents;"><div id="cart-items" class="cart-body"></div><div class="cart-footer"><div class="subtotal-row">Subtotal: <span id="cart-subtotal">$0</span></div><button onclick="goToCheckout()" class="btn-primary">Terminar Compra</button></div></div>
        <div id="checkout-view" class="checkout-view hidden" style="display:contents;">
            <div class="checkout-body">
                <button onclick="backToCart()" class="back-link">â† Volver</button>
                <div class="delivery-switch-container"><button id="btn-mode-delivery" class="btn-mode active" onclick="setDeliveryMode('delivery')">ğŸ›µ Domicilio</button><button id="btn-mode-pickup" class="btn-mode" onclick="setDeliveryMode('pickup')">ğŸ›ï¸ Recoger</button></div>
                <div id="address-section"><input type="text" id="address-street" placeholder="Calle" class="input-checkout"><input type="text" id="address-num" placeholder="#" class="input-checkout"><input type="text" id="address-ref" placeholder="Ref" class="input-checkout"></div>
                <div id="pickup-msg" class="hidden">Recoger en local.</div>
                <div class="payment-options"><label class="radio-card"><input type="radio" name="payment" value="Efectivo" checked onchange="handlePaymentChange()">ğŸ’µ Efectivo</label><label class="radio-card"><input type="radio" name="payment" value="Terminal" onchange="handlePaymentChange()">ğŸ’³ Terminal</label><label class="radio-card"><input type="radio" name="payment" value="Transferencia" onchange="handlePaymentChange()">ğŸ“± Transferencia</label></div>
                <div id="payment-details" class="hidden"></div>
            </div>
            <div class="cart-footer"><div class="summary-row">Total: <span id="checkout-total">$0</span></div><button onclick="processOrder()" id="btn-confirm-order" class="btn-success">Confirmar Pedido</button></div>
        </div>
    </div>
    
    <script type="module" src="script.js"></script>
</body>
</html>
